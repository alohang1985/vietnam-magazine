# 2026-02-22 — 작업 기록 (Pre-compaction flush)

- Frontend (Next.js) 변경
  - apps/frontend-next/app/page.tsx
    - 카드 레이아웃 수정: 이미지 상단 고정 높이(240px), object-fit: cover, 이미지 영역을 Link로 래핑, 텍스트(카테고리/제목)는 이미지 아래 배치
    - 마크다운 미리보기 생성식 정규식 교체: 이미지/링크 마크다운 제거 후 120자 + '...'
  - apps/frontend-next/app/posts/[slug]/page.tsx
    - 포스트 히어로 이미지 고정 높이(400px), 이미지 아래에 제목/카테고리 배치
    - 본문(prose) 배경 흰색, 메인 텍스트 #222, h2 왼쪽 초록 보더, strong 초록, p 색 #333 줄간격 1.9
    - Unsplash 크레딧(예: "Photo by ... on Unsplash")가 본문 상단에 삽입되는 경우: 추출해 본문에서 제거하고 글 맨 아래에 작은 글씨로 표시하도록 수정

- Auto-post 스크립트
  - scripts/auto-post.js
    - createPost에서 slug 생성식 정규화: (data.slug + '-' + Date.now()).replace(/[^A-Za-z0-9\-_.~]/g, '').toLowerCase()

- Telegram bot 추가 및 개선
  - telegram-bot/bot.js, telegram-bot/package.json 추가
    - 기능: Telegram 폴링, Gemini(generative)로 포스트 생성, Unsplash 이미지 검색, Strapi에 포스트 생성
    - 주요 env: TELEGRAM_BOT_TOKEN, GEMINI_API_KEY, STRAPI_URL, STRAPI_API_TOKEN, UNSPLASH_ACCESS_KEY
  - 여러 차례 개선 적용 (모두 커밋 & push 됨)
    - generationConfig 추가: maxOutputTokens: 3000, temperature: 0.7
    - 프롬프트 강화: JSON 전용 응답 요구 (strict JSON-only prompt)
    - 응답 로깅 추가: Gemini raw response 일부 로그 출력
    - cleaned 처리 강화: 코드펜스 제거 정규식 보강
    - JSON 파싱 로직 개선: 여러 단계의 파싱/추출 시도(직접 JSON.parse → 정규식으로 content 포함 객체 → 필드별 정규식 추출 및 안전한 객체 반환)

- Git
  - 모든 변경사항은 main 브랜치에 커밋되고 푸시됨
  - 주요 커밋 메시지 예: 
    - feat(frontend): restructure card and post hero - image above, text below, fixed heights and typography
    - fix(frontend): sanitize markdown preview (remove image/link markdown)
    - fix(frontend): move Unsplash credit from top to bottom and render clean content
    - fix(auto-post): sanitize slug when creating post
    - feat(bot): add Telegram auto-posting bot with Gemini + Unsplash integration
    - fix(bot): add generationConfig and safer JSON extraction from Gemini response
    - feat(bot): stricter JSON-only prompt (Korean article)
    - chore(bot): log Gemini raw response and be more tolerant when extracting JSON
    - fix(bot): more robust removal of code fences from Gemini response
    - fix(bot): robust JSON parsing with fallbacks and field extraction

- 남은 작업(권장)
  - GitHub 워크플로우/CI에서 필요한 시크릿 설정 확인: GEMINI_API_KEY, STRAPI_API_TOKEN, UNSPLASH_ACCESS_KEY 등
  - Strapi에서 API 토큰 권한(생성/게시) 확인
  - 자동화 스크립트의 Gemini 응답 형식 변화 대비: 재시도/정제 로직 강화 권장
  - Frontend: 모바일 반응형/SEO(OG) 확인 및 markdown rendering(HTML vs markdown) 검증

(저장 시간: 2026-02-22)
