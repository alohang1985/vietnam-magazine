2026-02-18 — 세션 메모 (pre-compaction flush)

피디님 활동 요약:
- 09:06 Telegram: "지금 수익은?" → positions 확인 및 간단 요약 전달.
- 09:09 사용자가 요청: 오늘 매수/매도 횟수 및 이유 보고 → trades CSV 및 paper_trader 로그로 확인. 오늘 매수 1건(DOT_KRW 2026-02-18T00:26:13), 매도 0건 보고.

자동매매(페이퍼) 변경 이력:
- 09:13 스캘핑 모드(A) 활성화: tuning.json 생성(size_pct=0.02, tp_partial=1.01, tp_final=1.02, dca_step=0.5, max_dca_steps=0).
- 10:00 사용자 요청으로 공격적 스캘핑 및 수수료/슬리피지 시뮬 추가:
  - paper_trader.py에 SLIPPAGE_PCT, FEE_PCT 적용(기본 0.0005=0.05%) 및 로그에 fee 필드 추가.
  - 이후 CSV writer header 문제 발생(ValueError) 해결: _append_log에 fee 필드 추가.
- 10:06 dependency 제거: 불필요한 'requests' import 삭제(venv 패키지 문제 회피).
- 10:06~10:31 여러 차례 tuning.json 업데이트:
  - size_pct 0.01, tp_partial 1.007 → 이후 1.004(0.4%) 적용
  - tp_final 최종 1.01 적용
  - SLIPPAGE_PCT=0.0005, FEE_PCT=0.0005로 실행
- paper_trader 재시작: FAST_MODE=1, INITIAL_CASH=20000000 환경으로 여러 번 재시작되었음.

알림/모니터링:
- BUY/SELL 알림 watcher 활성화: paper_trades.csv에 새 BUY 행이 append되면 Telegram(1949319722)으로 즉시 알림 전송 설정 완료.
- 실시간 모니터링(핫라인) 요청 받아 활성화(사용자 "예" 응답).

문제 조사 및 수정 (대시보드 UI):
- 사용자 제보: UI에서 Positions 칸과 Recent Trades의 날짜가 잘림.
- 조사: trades CSV에 인접 중복 행 다수 발견(FAST_MODE 반복 기록으로 추정).
- 조치:
  - paper_trades.csv 백업 및 인접 중복 행(dedupe) 제거. 백업 파일: logs/paper_trades.csv.bak_YYYYMMDDHHMMSS
  - dashboard-api의 positions 계산 로직(updatePositionsCache) 검토: trades 파일을 읽어 positionsCache를 구성함(총포지션 가치 계산 로직 확인).
  - frontend CSS 수정: dashboard-ui/src/App.css에서 .trades 및 .positions 스타일 조정(테이블 레이아웃 auto로 변경, positions min-width/overflow 추가).
  - frontend 빌드(npm run build) 및 정적 서버(npx serve) 재시작으로 최신 build 서빙 강제.
  - dashboard-api(node server.js) 재시작 확인.
- 결과: /api/positions에서 계산된 값 확인(initialCash 20000000, cashRemaining 0, totalPositionValue 53054909, totalUnrealized 50825). UI 반영이 브라우저 캐시/serve 프로세스 문제로 지연될 수 있어 serve 프로세스 재시작으로 해결 시도함.

운영 권고(미해결/권장):
- paper_trader 중복 인스턴스 여부 확인 및 하나로 통제(중복 실행 시 중복 로그 재발).
- paper_trader의 로그 쓰기에 간단한 파일 잠금 또는 마지막 쓰기 가드 추가 권장.
- 수수료·슬리피지 시뮬의 현실성 검증(실거래 수수료와 맞춰서 테스트).
- UI: Recent Trades 날짜 컬럼 고정 폭 또는 툴팁 적용 권장(사용자 UX 개선).

파일/위치 참고:
- trades CSV: /Users/youngdonjang/.openclaw/workspace/bithumb_mvp/logs/paper_trades.csv (백업본 존재)
- paper_trader log: /Users/youngdonjang/.openclaw/workspace/bithumb_mvp/logs/paper_trader_run.log
- dashboard-api: /Users/youngdonjang/.openclaw/workspace/dashboard-api/server.js (positions cache 및 broadcasting)
- frontend css 변경: /Users/youngdonjang/.openclaw/workspace/dashboard-ui/src/App.css
- frontend build: /Users/youngdonjang/.openclaw/workspace/dashboard-ui/build

추가 변경(이 세션):
- 11:01~11:04: 프런트엔드 CSS 실험(좌우 스크롤 제거, 패널 고정 등)을 적용했다가 사용자가 이전 스타일 복원을 요청하여 원래 App.css로 다시 되돌림(빌드 및 정적 서버 재시작 포함).
- 11:01: 백업 목록 확인 및 최신 백업(paper_trades.2026-02-18T033834378Z.bak)에서 복원 후 positions 캐시 재계산.
- 11:01: 사용자 요청으로 전체 초기화 진행 — trades 백업(paper_trades.pre_reset.<ts>.bak) 생성 후 trades 파일 헤더-only로 리셋함.
- 11:02: 새로운 보수적 DCA 전략을 tuning.json에 반영하고 paper_trader를 pm2로 재시작(FAST_MODE=1으로 테스트 모드).

간단 상태: 페이퍼 트레이더는 현재 FAST_MODE(테스트)로 재시작된 상태이며, trades 파일은 리셋되어 과거 내역은 백업에 보관됨. 프런트엔드 App.css는 사용자 요청으로 원래대로 복원됨.

-- End of 2026-02-18 session snapshot --
